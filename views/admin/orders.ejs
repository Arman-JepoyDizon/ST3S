<%- include('../partials/adminHeader') %>

<div class="admin-container">
    <%- include('../partials/adminSidebar', { activePage: 'orders' }) %>

    <div class="admin-content">
        <%- include('../partials/adminNavbar') %>

        <main class="p-3">
            <div class="page-header mb-3">
                <h2 class="h3 mb-0">All Orders</h2>
                <p class="text-muted">A complete history of all sales records</p>
            </div>

            <div class="form-floating mb-4">
                <input type="search" class="form-control" id="searchOrders" placeholder="Search by order number...">
                <label for="searchOrders"><i class="bi bi-search me-2"></i>Search by order number...</label>
            </div>

            <div class="transaction-list">
                <% if (transactions && transactions.length > 0) { %>
                    <% transactions.forEach(transaction => { %>
                        <div class="card transaction-card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="fw-bold">ORD-<%= transaction._id.toString().slice(-6).toUpperCase() %></h6>
                                        <% if (transaction.customerName) { %>
                                            <p class="text-primary fw-bold mb-0 customer-name-display">
                                                <i class="bi bi-person-badge"></i> 
                                                <%= transaction.customerName %>
                                            </p>
                                        <% } %>
                                        <small class="text-muted d-block mt-1">
                                            <i class="bi bi-calendar-event"></i>
                                            <%= new Date(transaction.createdAt).toLocaleDateString() %>
                                        </small>
                                        <small class="text-muted d-block">
                                            <i class="bi bi-person"></i> 
                                            <%= transaction.createdBy ? transaction.createdBy.username : 'N/A' %>
                                        </small>
                                    </div>
                                    <% if (transaction.status === 'Completed') { %>
                                        <span class="badge badge-status-completed">Completed</span>
                                    <% } else if (transaction.status === 'Cancelled') { %>
                                        <span class="badge badge-status-cancelled">Cancelled</span>
                                    <% } else if (transaction.status === 'Ready') { %>
                                        <span class="badge badge-status-ready">Ready</span>
                                    <% } else { %>
                                        <span class="badge badge-status-pending">Pending</span>
                                    <% } %>
                                </div>
                                
                                <ul class="list-group list-group-flush sales-item-list my-2">
                                    <% transaction.items.forEach(item => { %>
                                        <li class="list-group-item d-flex justify-content-between align-items-center px-0 py-1">
                                            <span>
                                                <span class="fw-bold"><%= item.quantity %>x</span> <%= item.productId ? item.productId.name : 'Product not found' %>
                                            </span>
                                        </li>
                                    <% }) %>
                                </ul>

                                <div class="d-flex justify-content-between align-items-center border-top pt-2">
                                    <p class="text-muted mb-0"><%= transaction.items.length %> <%= transaction.items.length > 1 ? 'types of items' : 'type of item' %></p>
                                    <p class="fw-bold text-primary fs-5 mb-0">â‚±<%= transaction.totalAmount.toFixed(2) %></p>
                                </div>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div class="card text-center py-5">
                         <div class="card-body">
                            <p class="text-muted">No transactions have been made yet.</p>
                        </div>
                    </div>
                <% } %>
            </div>
        </main>
    </div>
</div>

<%- include('../partials/adminBottomNav', { activePage: 'orders' }) %>
<%- include('../partials/adminFooter') %>